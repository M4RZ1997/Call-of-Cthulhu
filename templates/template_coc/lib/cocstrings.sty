\ExplSyntaxOn % Use tilde (~) for spaces.

% \addto\captions<language> cannot handle macros with parameters
% We need to make our own parameters
% |1| represents parameter 1

\cs_new_protected:Npn \__coc_caption:nn #1#2
{
	\group_begin:
		\str_set:Nx \l_tmpa_str { #1 }
		\str_set:Nx \l_tmpb_str { #2 }
		\exp_args:NNnx \str_replace_all:Nnn \l_tmpa_str { |1| } { #2 }
		\str_use:N \l_tmpa_str
	\group_end:
}

% Document-level version for backwards compatibility
\NewDocumentCommand{\CoCCaption}{ m m }
	{ \__coc_caption:nn {#1} {#2} }

% Define all strings as new macros instead of hardcoding them in the
% TeX files. This then allows us to add captions for multilanguage support.

% If you add or update a caption here, add it to languages/_template.sty
% as well.

%% Monster
% Ability Scores
\newcommand\strstatname{STR}
\newcommand\constatname{CON}
\newcommand\dexstatname{DEX}
\newcommand\intstatname{INT}
\newcommand\sizstatname{SIZ}
\newcommand\powstatname{POW}
\newcommand\appstatname{APP}
\newcommand\edustatname{EDU}

% Attacks
\newcommand\unitsname{ft.}

% Quests
\newcommand\locationname{Location}
\newcommand\questgivername{Quest~Giver}
\newcommand\objectivename{Objective}

% Miscellaneous
\newcommand\pageabbreviationname{pg.}
\newcommand\dname{d}
\newcommand\tocchapterabbreviationname{Chapter}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Adding languages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% To add captions for other languages:
% 1. Copy and paste languages/_template.sty to languages/<language>.sty
% 2. Substitute the <language> token in the file with the language name
%    (i.e. \addto\captionsfrench).
% 3. Replace the English strings with the translations and comment any captions
%    that you do not translate. Please keep the captions in the same order.
% 4. Add \RequirePackage{lib/languages/<language>} to the following function.
\cs_new_protected_nopar:Npn \__dnd_input_languages:
  {
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/italian}
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/japanese} % Requires LuaTeX or XeTeX
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/ngerman}
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/russian}
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/spanish}
%    \RequirePackage{\PATH templates/template_dnd/lib/languages/french}
}

% Delay loading captions until after the user has imported a language package.
% Enables using babel/polyglossia with the dndbook document class as well as the
% dnd package.
%
% Both language packages use \AtBeginDocument. Use \AtEndPreamble (etoolbox)
% instead to side-step load order issues.
\AtEndPreamble{
  % Check if either babel or polyglossia have been loaded,
  % in which case load the string captions
  \@ifpackageloaded{babel}{
    \__dnd_input_languages:
  }{}
  \@ifpackageloaded{polyglossia}{
    \__dnd_input_languages:
  }{}
}
